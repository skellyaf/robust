function A = cr3bp_stt3_dHessian(x, mu)

% global mu;
% derivation in C:\Users\skell\OneDrive - USU\Documents\PhD\research\stochastics\gradients\gradient_partials.m
x_state = x;
% r = [x(1); x(2); x(3)];
% v = [x(4); x(5); x(6)];

x = x_state(1);
y = x_state(2);
z = x_state(3);
% norm_r = norm(r);
% ur = r/norm_r;


Uxx = [(9*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (9*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (45*mu*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (45*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (15*mu*(8*mu + 8*x - 8)*(mu + x - 1))/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) + (15*(8*mu + 8*x)*(mu + x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) + (105*mu*(2*mu + 2*x - 2)^3*(mu + x - 1))/(8*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*(2*mu + 2*x)^3*(mu + x)*(mu - 1))/(8*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                               (15*y*(2*mu + 2*x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*y*(2*mu + 2*x - 2))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*y*(2*mu + 2*x - 2)^2*(mu + x - 1))/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y*(2*mu + 2*x)^2*(mu + x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                               (15*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*z*(2*mu + 2*x - 2))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*z*(2*mu + 2*x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*z*(2*mu + 2*x - 2)^2*(mu + x - 1))/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*z*(2*mu + 2*x)^2*(mu + x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2));
                                                                                                                                                                                                                                                                                      (15*y*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(8*mu + 8*x - 8))/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (105*y*(2*mu + 2*x)^3*(mu - 1))/(8*((mu + x)^2 + y^2 + z^2)^(9/2)) + (15*y*(8*mu + 8*x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) + (105*mu*y*(2*mu + 2*x - 2)^3)/(8*((mu + x - 1)^2 + y^2 + z^2)^(9/2)), (3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y^2*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y^2*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                                                                                                                                                                                                 (15*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y*z*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y*z*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2));
                                                                                                                                                                                                                                                                                      (15*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(8*mu + 8*x - 8))/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (105*z*(2*mu + 2*x)^3*(mu - 1))/(8*((mu + x)^2 + y^2 + z^2)^(9/2)) + (15*z*(8*mu + 8*x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) + (105*mu*z*(2*mu + 2*x - 2)^3)/(8*((mu + x - 1)^2 + y^2 + z^2)^(9/2)),                                                                                                                                                                                                                                 (15*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y*z*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y*z*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2)), (3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*z^2*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*z^2*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(9/2))];


Uyy = [(3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) + (105*mu*y^2*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y^2*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                   (45*y*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (45*mu*y*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (105*y^3*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) + (105*mu*y^3*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(9/2),                                                                                                                                                           (15*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y^2*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y^2*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2)
                                                                                                                                                                                                                                      (45*y*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (45*mu*y*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (105*y^3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)) + (105*mu*y^3*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)), (9*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (9*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (90*y^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (105*y^4*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (90*mu*y^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y^4)/((mu + x - 1)^2 + y^2 + z^2)^(9/2),                                                                                                                                                                                                   (45*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*y^3*z)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y^3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (45*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2)
                                                                                                                                                                                                                                  (15*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (105*mu*y^2*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y^2*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                                                       (45*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*y^3*z)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y^3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (45*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2), (3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (15*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y^2*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y^2*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2)];
 
 
Uzz = [(3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) + (105*mu*z^2*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*z^2*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)),                                                                                                                                                           (15*y*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y*z^2*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y*z^2*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2),                                                   (45*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*z^3*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*z^3*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (45*mu*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2)
                                                                                                                                                                                                                                  (15*y*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (105*mu*y*z^2*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)) - (105*y*z^2*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)), (3*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (15*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) - (15*mu*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*y^2*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y^2*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2),                                                                                       (45*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*y*z^3)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y*z^3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (45*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2)
                                                                                                                                                                                                                                      (45*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (45*mu*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) - (105*z^3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(9/2)) + (105*mu*z^3*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(9/2)),                                                                                                                                                                                                   (45*y*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (105*mu*y*z^3)/((mu + x - 1)^2 + y^2 + z^2)^(9/2) - (105*y*z^3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (45*mu*y*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2), (9*mu)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (9*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (90*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (105*z^4*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(9/2) - (90*mu*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (105*mu*z^4)/((mu + x - 1)^2 + y^2 + z^2)^(9/2)];
 

A = zeros(6,6,6);
A(4:6,1:3,1) = Uxx;

A(4:6,1:3,2) = Uyy;

A(4:6,1:3,3) = Uzz;

end