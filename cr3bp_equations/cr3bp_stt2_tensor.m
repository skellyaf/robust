function A = cr3bp_stt2_tensor(x, mu)

% global mu;
x_state = x;
% r = [x(1); x(2); x(3)];
% v = [x(4); x(5); x(6)];

x = x_state(1);
y = x_state(2);
z = x_state(3);
% norm_r = norm(r);
% ur = r/norm_r;


Ux = [(3*mu*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(2*mu + 2*x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (3*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (3*mu*(2*mu + 2*x - 2))/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (15*mu*(2*mu + 2*x - 2)^2*(mu + x - 1))/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)) + (15*(2*mu + 2*x)^2*(mu + x)*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)),                 (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                 (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*z*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2));
                                                                                                                                                            (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)), (3*mu*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(5/2)) - (3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(5/2)) + (15*y^2*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y^2*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                                                                                                                                 (15*y*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2));
                                                                                                                                                            (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*z*(2*mu + 2*x)^2*(mu - 1))/(4*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(2*mu + 2*x - 2)^2)/(4*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                                                                                                                                 (15*y*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)), (3*mu*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(5/2)) - (3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(5/2)) + (15*z^2*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z^2*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2))];

Uy = [                (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)), (3*mu*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*y^2*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y^2*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2),                                                                             (15*y*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2);
(3*mu*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(5/2)) - (3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(5/2)) + (15*y^2*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y^2*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                                         (15*y^3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (9*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (9*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y^3)/((mu + x - 1)^2 + y^2 + z^2)^(7/2), (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y^2*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y^2*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2);
                                                                                                                                (15*y*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                                     (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y^2*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y^2*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2), (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2)];
 
 
Uz = [                (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) + (15*z*(2*mu + 2*x)*(mu + x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z*(2*mu + 2*x - 2)*(mu + x - 1))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)),                                                                             (15*y*z*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) - (15*mu*y*z*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2), (3*mu*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*z^2*(mu + x - 1))/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*z^2*(mu + x)*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2);
                                                                                                                                (15*y*z*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*y*z*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)), (3*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y^2*z)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y^2*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2),                                     (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2);
(3*mu*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(5/2)) - (3*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(5/2)) + (15*z^2*(2*mu + 2*x)*(mu - 1))/(2*((mu + x)^2 + y^2 + z^2)^(7/2)) - (15*mu*z^2*(2*mu + 2*x - 2))/(2*((mu + x - 1)^2 + y^2 + z^2)^(7/2)), (3*mu*y)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (3*y*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*y*z^2)/((mu + x - 1)^2 + y^2 + z^2)^(7/2) + (15*y*z^2*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2),                                         (15*z^3*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(7/2) + (9*mu*z)/((mu + x - 1)^2 + y^2 + z^2)^(5/2) - (9*z*(mu - 1))/((mu + x)^2 + y^2 + z^2)^(5/2) - (15*mu*z^3)/((mu + x - 1)^2 + y^2 + z^2)^(7/2)];


A = zeros(6,6,6);
A(4:6,1:3,1) = Ux;

A(4:6,1:3,2) = Uy;

A(4:6,1:3,3) = Uz;

end