function A = br4bp_sb1_stt2_tensor(X, mub, mu, a4)

% Derivation for the following in
% C:\Users\skell\OneDrive - USU\Documents\PhD\research\BR4BP\stt_equations\br4bp_symbolic_gradient_partials_for_stt.m

assert(length(X)==7);

x = X(1);
y = X(2);
z = X(3);
theta_em = X(7);

vecr3 = [x; y; z];
vecr4 = [-mub; 0; 0];

xe = 1 - mub - 1/a4 * mu * cos(theta_em);
ye = -1/a4 * mu *sin(theta_em);

xm = 1 - mub + 1/a4 * (1-mu) * cos(theta_em);
ym = 1/a4 * (1-mu) * sin(theta_em);

vecr1 = [xe; ye; 0];
vecr2 = [xm; ym; 0];

vecr13 = vecr3 - vecr1;
vecr23 = vecr3 - vecr2;
vecr43 = vecr3 - vecr4;

r13 = vecnorm(vecr13);
r23 = vecnorm(vecr23);
r43 = vecnorm(vecr43);




%% Partials
%dAdx
Axs =  [[(9*mu*mub*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - ((2*mub + 2*x)*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*(2*mub + 2*x)*(mub - 1))/(2*((mub + x)^2 + y^2 + z^2)^(5/2)) + (5*(2*mub + 2*x)*(3*mub - 3)*(mub + x)^2)/(2*((mub + x)^2 + y^2 + z^2)^(7/2)) - (9*mub*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mub*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1)^2)/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                                                                       (3*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*y*(mub - 1))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (5*y*(3*mub - 3)*(mub + x)^2)/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1)^2)/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2)/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*z*(2*mub + 2*x)*(3*mub - 3)*(mub + x))/(2*((mub + x)^2 + y^2 + z^2)^(7/2)) + (15*mub*z*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2))];
       [                                                                                                                                              (3*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*y*(mub - 1))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (5*y*(3*mub - 3)*(mub + x)^2)/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1)^2)/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2)/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*y^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mub*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                                                                                       (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)];
       [                                                                                                                                                                                (3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*z*(2*mub + 2*x)*(3*mub - 3)*(mub + x))/(2*((mub + x)^2 + y^2 + z^2)^(7/2)) + (15*mub*z*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                               (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2),                             (3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*z^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*z^2*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2) + (15*mub*z^2*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)]];

Axst = [(3*mu*mub*sin(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*sin(theta_em)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*mu*mub*sin(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*z*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2))];
 

%dAdy
Ays = [[                                                                      (3*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*y*(mub - 1))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (5*y*(3*mub - 3)*(mub + x)^2)/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1)^2)/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2)/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*y^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mub*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                   (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)];
      [(3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*y^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mub*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                 (5*y^3*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) - (2*y*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*y*(mub - 1))/((mub + x)^2 + y^2 + z^2)^(5/2) + (9*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (9*mub*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mub*(y + (mu*sin(theta_em))/a4)^2*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4)^2)/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*y^2*z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2))];
      [                                                                                                                                                                                                                                                                                                                                                                                                                                              (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2),                                                                                                                                                                             (3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*y^2*z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                 (5*y*z^2*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) - (3*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (y*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (3*mu*mub*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) + (15*mub*z^2*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z^2*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)]];


Ayst = [                                                                                                                                                                                                                                                                                                                                                                                                               (3*mu*mub*sin(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2));
       (3*mu*mub*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mu*mub*z*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2))];

%dAdz

Azs =   [[(3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*z*(2*mub + 2*x)*(3*mub - 3)*(mub + x))/(2*((mub + x)^2 + y^2 + z^2)^(7/2)) + (15*mub*z*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                   (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2), (3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*z^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*z^2*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2) + (15*mub*z^2*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)];
         [                                                                                                                                                                                                                                                                                                                                      (5*y*z*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z*(y + (sin(theta_em)*(mu - 1))/a4)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2), (3*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - (3*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (5*y^2*z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) + (15*mub*z*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) - (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(y + (sin(theta_em)*(mu - 1))/a4))/(2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                                                         (5*y*z^2*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) - (3*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (y*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (3*mu*mub*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) + (15*mub*z^2*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z^2*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)];
         [                            (3*mu*mub*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) - ((3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*mub*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (5*z^2*(3*mub - 3)*(mub + x))/((mub + x)^2 + y^2 + z^2)^(7/2) - (15*mu*mub*z^2*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2) + (15*mub*z^2*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2),                 (5*y*z^2*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) - (3*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) - (y*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) + (3*mu*mub*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) + (15*mub*z^2*(y + (mu*sin(theta_em))/a4)*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2) - (15*mu*mub*z^2*(y + (sin(theta_em)*(mu - 1))/a4))/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2),                                                                                                                               (5*z^3*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(7/2) - (2*z*(3*mub - 3))/((mub + x)^2 + y^2 + z^2)^(5/2) - (3*z*(mub - 1))/((mub + x)^2 + y^2 + z^2)^(5/2) - (15*mu*mub*z^3)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2) - (9*mub*z*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2) + (9*mu*mub*z)/((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2) + (15*mub*z^3*(mu - 1))/((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)]];


Azst = [                                                                                   (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*z*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2));
                                                                                                           (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mu*mub*z*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2));
 (15*mu*mub*z^2*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z^2*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2))];


%dAdt


Ats = [[(3*mu*mub*sin(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*sin(theta_em)*(mu - 1)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                                                                                                                                                               (3*mu*mub*sin(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)),                                                                                   (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*z*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2))];
      [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (3*mu*mub*sin(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (3*mu*mub*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(y + (mu*sin(theta_em))/a4)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*(y + (mu*sin(theta_em))/a4)*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                                                                           (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mu*mub*z*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2))];
      [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*z*sin(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)*(2*mub + 2*x + (2*cos(theta_em)*(mu - 1))/a4 - 2))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) + (15*mu*mub*z*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(2*mub + 2*x + (2*mu*cos(theta_em))/a4 - 2))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*z*cos(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (15*mu*mub*z*(2*y + (2*mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*z*(2*y + (2*sin(theta_em)*(mu - 1))/a4)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)), (15*mu*mub*z^2*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) - (3*mu*mub*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z^2*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2))]];


Atst = [(mu*mub*cos(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(3/2)) - (mu*mub*cos(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(3/2)) + (3*mu*mub*(mu - 1)*(sin(theta_em)*(y + (mu*sin(theta_em))/a4) + cos(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1) - (mu*cos(theta_em)^2)/a4 - (mu*sin(theta_em)^2)/a4)*(mub + x + (mu*cos(theta_em))/a4 - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*((2*mu*sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))/a4 - (2*mu*cos(theta_em)*(y + (mu*sin(theta_em))/a4))/a4)*(mu - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (3*mu^2*mub*sin(theta_em)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4^2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*sin(theta_em)*((2*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/a4 - (2*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*sin(theta_em)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)^2)/(a4^2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)*(cos(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) + sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4) - (cos(theta_em)^2*(mu - 1))/a4 - (sin(theta_em)^2*(mu - 1))/a4))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*((2*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/a4 - (2*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/a4)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) - (15*mu*mub*((2*mu*sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))/a4 - (2*mu*cos(theta_em)*(y + (mu*sin(theta_em))/a4))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))*(mub + x + (mu*cos(theta_em))/a4 - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2));
                                         (mu*mub*sin(theta_em)*(mu - 1))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(3/2)) - (mu*mub*sin(theta_em)*(mu - 1))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(3/2)) + (3*mu*mub*cos(theta_em)*((2*mu*sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))/a4 - (2*mu*cos(theta_em)*(y + (mu*sin(theta_em))/a4))/a4)*(mu - 1))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu^2*mub*cos(theta_em)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(a4^2*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) + (3*mu*mub*cos(theta_em)*((2*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/a4 - (2*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1)*(cos(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) + sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4) - (cos(theta_em)^2*(mu - 1))/a4 - (sin(theta_em)^2*(mu - 1))/a4))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) - (3*mu*mub*cos(theta_em)*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(mu - 1)^2)/(a4^2*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (3*mu*mub*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(sin(theta_em)*(y + (mu*sin(theta_em))/a4) + cos(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1) - (mu*cos(theta_em)^2)/a4 - (mu*sin(theta_em)^2)/a4))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (15*mu*mub*((2*mu*sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))/a4 - (2*mu*cos(theta_em)*(y + (mu*sin(theta_em))/a4))/a4)*(y + (mu*sin(theta_em))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2)) + (15*mu*mub*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*(y + (sin(theta_em)*(mu - 1))/a4)*((2*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/a4 - (2*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*mu*mub*z*(mu - 1)*(sin(theta_em)*(y + (mu*sin(theta_em))/a4) + cos(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1) - (mu*cos(theta_em)^2)/a4 - (mu*sin(theta_em)^2)/a4))/(a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(5/2)) - (3*mu*mub*z*(mu - 1)*(cos(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) + sin(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4) - (cos(theta_em)^2*(mu - 1))/a4 - (sin(theta_em)^2*(mu - 1))/a4))/(a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(5/2)) + (15*mu*mub*z*(sin(theta_em)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1) - cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4))*((2*cos(theta_em)*(y + (sin(theta_em)*(mu - 1))/a4)*(mu - 1))/a4 - (2*sin(theta_em)*(mu - 1)*(mub + x + (cos(theta_em)*(mu - 1))/a4 - 1))/a4)*(mu - 1))/(2*a4*((y + (sin(theta_em)*(mu - 1))/a4)^2 + (mub + x + (cos(theta_em)*(mu - 1))/a4 - 1)^2 + z^2)^(7/2)) - (15*mu*mub*z*((2*mu*sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1))/a4 - (2*mu*cos(theta_em)*(y + (mu*sin(theta_em))/a4))/a4)*(mu - 1)*(cos(theta_em)*(y + (mu*sin(theta_em))/a4) - sin(theta_em)*(mub + x + (mu*cos(theta_em))/a4 - 1)))/(2*a4*((mub + x + (mu*cos(theta_em))/a4 - 1)^2 + (y + (mu*sin(theta_em))/a4)^2 + z^2)^(7/2))];


%% Assembly
A = zeros(7,7,7);
A(4:6,1:3,1) = Axs;
A(4:6,7,1) = Axst;

A(4:6,1:3,2) = Ays;
A(4:6,7,2) = Ayst;

A(4:6,1:3,3) = Azs;
A(4:6,7,3) = Azst;

A(4:6,1:3,7) = Ats;
A(4:6,7,7) = Atst;


end